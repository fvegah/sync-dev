---
phase: 03-progress-display
plan: 04
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified:
  - frontend/src/lib/SyncStatus.svelte
autonomous: false

must_haves:
  truths:
    - "User sees list of actively syncing files"
    - "File list is scrollable and limited to 10 items"
    - "Progress display works smoothly without UI freeze"
    - "User confirms progress visibility is complete"
  artifacts:
    - path: "frontend/src/lib/SyncStatus.svelte"
      provides: "Active files list component"
      contains: "activeFiles"
  key_links:
    - from: "frontend/src/lib/SyncStatus.svelte"
      to: "frontend/src/stores/app.js"
      via: "activeFiles store"
      pattern: "\\$activeFiles"
---

<objective>
Add active files list display and perform human verification of the complete progress display feature.

Purpose: Complete the progress display feature by adding a scrollable list of actively syncing files, and verify with the user that all requirements are met.

Output:
- Enhanced `frontend/src/lib/SyncStatus.svelte` with active files list
- Human verification that progress display works correctly
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-progress-display/03-01-SUMMARY.md
@.planning/phases/03-progress-display/03-02-SUMMARY.md
@.planning/phases/03-progress-display/03-03-SUMMARY.md

# Source file to modify
@frontend/src/lib/SyncStatus.svelte
@frontend/src/stores/app.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add active files list to SyncStatus</name>
  <files>frontend/src/lib/SyncStatus.svelte</files>
  <action>
Enhance `frontend/src/lib/SyncStatus.svelte` to show a list of actively syncing files:

1. In the progress-section (after the single active file display from Plan 03), add a files list when multiple files are active:

Replace or extend the active-file section to show a list:
```svelte
{#if $progressData && ($syncStatus.status === 'syncing' || $overallPercentage > 0)}
    <div class="progress-section">
        <!-- Overall progress header -->
        <div class="progress-header">
            <span class="progress-title">Syncing Files</span>
            <span class="progress-meta">
                {#if $fileCountProgress}
                    <span class="file-count">{$fileCountProgress}</span>
                {/if}
            </span>
        </div>

        <!-- Global progress bar -->
        <div class="progress-info">
            <span class="progress-percentage">{Math.round($overallPercentage)}%</span>
            <span class="progress-stats">
                {#if $formattedSpeed}
                    <span class="speed">{$formattedSpeed}</span>
                {/if}
                {#if $formattedETA}
                    <span class="eta">{$formattedETA}</span>
                {/if}
            </span>
        </div>
        <div class="progress-bar global">
            <div class="progress-fill" style="width: {$overallPercentage}%"></div>
        </div>

        <!-- Active files list -->
        {#if $activeFiles.length > 0}
            <div class="active-files-section">
                <div class="section-header">
                    <span class="section-title">Active Transfers</span>
                    <span class="section-count">{$activeFiles.length} file{$activeFiles.length !== 1 ? 's' : ''}</span>
                </div>
                <div class="active-files-list">
                    {#each $activeFiles as file}
                        <div class="file-item">
                            <div class="file-info">
                                <span class="file-name" title={file.path}>{getFileName(file.path)}</span>
                                <span class="file-size">{formatBytesSync(file.transferred)} / {formatBytesSync(file.size)}</span>
                            </div>
                            <div class="file-progress-row">
                                <div class="progress-bar mini">
                                    <div class="progress-fill" style="width: {file.percentage}%"></div>
                                </div>
                                <span class="file-percent">{Math.round(file.percentage)}%</span>
                            </div>
                        </div>
                    {/each}
                </div>
            </div>
        {/if}
    </div>
{/if}
```

2. Add helper function in the script section:
```javascript
function getFileName(path) {
    if (!path) return '';
    const parts = path.split('/');
    return parts[parts.length - 1] || path;
}
```

3. Add CSS styles for the files list:
```css
.active-files-section {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.section-title {
    font-size: 0.8rem;
    font-weight: 500;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.section-count {
    font-size: 0.75rem;
    color: #64748b;
}

.active-files-list {
    max-height: 200px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.file-item {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    padding: 10px 12px;
}

.file-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
}

.file-item .file-name {
    font-size: 0.8rem;
    color: #e2e8f0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 60%;
}

.file-size {
    font-size: 0.7rem;
    color: #64748b;
    font-family: monospace;
}

.file-progress-row {
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-bar.mini {
    flex: 1;
    height: 4px;
}

.file-percent {
    font-size: 0.7rem;
    font-weight: 500;
    color: #60a5fa;
    min-width: 32px;
    text-align: right;
}

/* Scrollbar styling for files list */
.active-files-list::-webkit-scrollbar {
    width: 6px;
}

.active-files-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
}

.active-files-list::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
}

.active-files-list::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}
```

4. Remove any redundant single-file display code that was added in Plan 03 (the active-file div), as the files list now handles all cases.
  </action>
  <verify>
Build the app: `wails3 build`
Run and trigger a sync with multiple files.
Verify the files list appears with:
- File names (just filename, not full path)
- Transfer progress for each file
- Scrollable if more than fits in view
- Max 10 files shown (limited by backend)
  </verify>
  <done>
Active files list added showing:
- Each actively syncing file
- Individual progress bars per file
- Bytes transferred / total size
- Percentage for each file
- Scrollable list with styled scrollbar
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete progress display feature including:
- Global progress bar with overall percentage
- Transfer speed in MB/s format
- Estimated time remaining (ETA)
- File count progress (X of Y files)
- Active files list with per-file progress
- Throttled updates (no UI freeze)
  </what-built>
  <how-to-verify>
1. Build and run the app: `wails3 dev`
2. Set up a folder pair with another device (or use existing)
3. Add several files (10+) to trigger sync
4. Click "Sync Now" and observe:
   - [ ] Global progress bar fills smoothly (not jumpy)
   - [ ] Percentage updates incrementally
   - [ ] Speed shows (e.g., "2.5 MB/s") and updates
   - [ ] ETA appears after ~5% complete
   - [ ] File count shows "X of Y files"
   - [ ] Active files list shows individual files
   - [ ] Each file has its own progress bar
   - [ ] UI remains responsive during sync (no freeze)
5. Let sync complete and verify progress resets
  </how-to-verify>
  <resume-signal>Type "approved" if all items work, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before checkpoint:
1. `wails3 build` succeeds
2. App runs without JavaScript errors
3. Progress display appears during sync

Checkpoint verifies:
- All PROG requirements met (PROG-01 through PROG-04)
- UI performance is smooth
- Progress data is accurate
</verification>

<success_criteria>
- Active files list displays during sync
- List shows file name, size, and individual progress
- List is scrollable (max-height with overflow)
- Global progress, speed, ETA all visible
- UI does not freeze during large syncs
- Human approves the complete feature
</success_criteria>

<output>
After completion, create `.planning/phases/03-progress-display/03-04-SUMMARY.md`
</output>
